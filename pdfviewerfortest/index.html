<!DOCTYPE html>
<html lang="pl" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="api-base" content="http://localhost:5000">
  <title>PDF Viewer</title>
  <link rel="icon" href='data:image/svg+xml;utf8,
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <defs>
    <linearGradient id="gradCape1" x1="0%" y1="0%" x2="80%" y2="80%">
      <stop offset="0%" stop-color="%2351A2E9"/>
      <stop offset="50%" stop-color="%23A878A2"/>
      <stop offset="100%" stop-color="%23FF4D5A"/>
    </linearGradient>
  </defs>
  <!-- Maksymalnie duża lupa -->
  <circle cx="28" cy="28" r="18" stroke="url(%23gradCape1)" stroke-width="6" fill="none"/>
  <line x1="38" y1="38" x2="52" y2="52" stroke="url(%23gradCape1)" stroke-width="6" stroke-linecap="round"/>
</svg>'
  >



  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config = { darkMode: 'class' };</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen relative overflow-hidden">

<!-- LEWA STRONA – PDF Viewer -->
<div id="pdf-container" class="flex h-screen w-[calc(100%-min(50%,505px))] border-r border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 overflow-hidden">

  <!-- Miniaturki -->
  <div id="pdf-thumbnails" class="flex flex-col items-center py-2 px-1 bg-gray-100 dark:bg-gray-900 overflow-y-auto gap-2 w-20 border-r border-gray-300 dark:border-gray-700 flex-shrink-0"></div>

  <div class="flex-1 flex flex-col items-center justify-start p-2">
    <div class="flex items-center justify-start gap-2 w-full mb-2">
      <h2 class="text-lg font-bold text-blue-500">📄 PDF Viewer</h2>

      <!-- Panel przycisków -->
      <div class="flex flex-wrap items-center gap-2 ml-auto text-sm">
        <button id="zoom-out" class="px-2 py-1 bg-gray-500 text-white rounded hover:bg-gray-600">−</button>
        <span id="zoom-level" class="font-semibold w-14 text-center">100%</span>
        <button id="zoom-in" class="px-2 py-1 bg-gray-500 text-white rounded hover:bg-gray-600">+</button>
        <button id="reset-zoom" class="px-2 py-1 bg-gray-500 text-white rounded hover:bg-gray-600">Reset</button>
        <button id="fit-width" class="px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700" title="Dopasuj szerokość">↔</button>
        <button id="fit-height" class="px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700" title="Dopasuj wysokość">↕</button>
        <input type="file" id="file-input" accept="application/pdf" class="hidden">
        <button id="open-file" class="px-2 py-1 bg-green-600 text-white rounded hover:bg-green-700">📂 Otwórz PDF</button>
        <a id="download" href="./cv.pdf" download class="px-2 py-1 bg-indigo-600 text-white rounded hover:bg-indigo-700">💾 Pobierz PDF</a>
      </div>
    </div>

    <!-- Obszar PDF -->
    <div id="pdf-view" class="flex-1 relative overflow-auto flex flex-col items-center gap-4 w-full cursor-default"></div>
    <p id="pdf-error" class="text-red-500 mt-2 hidden"></p>
  </div>
</div>

<!-- Toast powiadomień (domyślnie ukryty) -->
<div id="pdf-toast" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2
    bg-gray-700 text-white font-bold px-4 py-2 rounded shadow-lg text-center z-50
    opacity-0 transition-all duration-300 pointer-events-none flex items-center gap-2">
</div>



<!-- === RIGHT SIDE: TEST PANEL === -->
<div id="test-panel"
     class="fixed top-0 right-0 h-full w-1/2 max-w-lg bg-gray-50 dark:bg-gray-800 shadow-xl shadow-black/30 transform translate-x-0 transition-transform duration-300 flex flex-col z-50">

  <!-- Toggle handle
  <button id="toggle-panel"
          class="absolute left-[-40px] top-1/2 transform -translate-y-1/2 w-12 h-24 bg-blue-500 text-white rounded-l-full flex items-center justify-center shadow-lg text-2xl hover:bg-blue-600 transition-transform transition-colors z-50"
          aria-label="Toggle panel">
    &#x276F;
  </button>-->

  <!-- Content -->
  <div class="p-4 mt-4 flex flex-col h-full">
    <p>API Status: <span id="status" data-testid="status">?</span></p>

    <!-- Tabs -->
    <div class="mb-2 flex space-x-2">
      <button class="tab-btn flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-500 text-white rounded transition transform hover:scale-105"
              data-type="api" title="API (Java)">
        <div class="p-1 rounded bg-white/20 shadow-md">
          <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/java/java-original.svg" class="w-6 h-6">
        </div><span class="hidden sm:inline">API</span>
      </button>

      <button class="tab-btn flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-500 text-white rounded transition transform hover:scale-105"
              data-type="selenium" title="Selenium (Python)">
        <div class="p-1 rounded bg-white/20 shadow-md">
          <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/python/python-original.svg" class="w-6 h-6">
        </div><span class="hidden sm:inline">Selenium</span>
      </button>

      <button class="tab-btn flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-500 text-white rounded transition transform hover:scale-105"
              data-type="cypress" title="Cypress (TypeScript)">
        <div class="p-1 rounded bg-white/20 shadow-md">
          <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/typescript/typescript-original.svg" class="w-6 h-6">
        </div><span class="hidden sm:inline">Cypress</span>
      </button>
    </div>

    <button id="rerun-test"
            class="px-2 py-1 bg-blue-400 hover:bg-blue-500 text-white rounded text-sm shadow-sm transition-colors">
      Rerun Test!
    </button>

    <div id="test-status"
         class="mb-2 p-2 rounded font-bold text-center transition-colors"></div>

    <pre id="test-code"
         class="flex-1 overflow-auto p-3 bg-white dark:bg-gray-700 rounded text-sm whitespace-pre-wrap"></pre>
  </div>
</div>

<button id="toggle-theme" class="fixed left-4 bottom-4 px-4 py-2 bg-blue-500 text-white rounded-2xl shadow-lg z-50">Dark/Light</button>


<!-- PDF + Miniatures + Zoom + Open File -->
<script>
  /* Konfiguracja */
  const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10 MB
  const defaultPDF = './cv.pdf';

  const pdfView = document.getElementById('pdf-view');
  const pdfThumbs = document.getElementById('pdf-thumbnails');
  const errorMsg = document.getElementById('pdf-error');
  const zoomLevelDisplay = document.getElementById('zoom-level');
  const toast = document.getElementById('pdf-toast');

  const btnZoomIn = document.getElementById('zoom-in');
  const btnZoomOut = document.getElementById('zoom-out');
  const btnResetZoom = document.getElementById('reset-zoom');
  const btnFitWidth = document.getElementById('fit-width');
  const btnFitHeight = document.getElementById('fit-height');

  const fileInput = document.getElementById('file-input');
  const btnOpenFile = document.getElementById('open-file');

  let pdfDoc = null;
  let scale = 1.2;
  const minScale = 0.5, maxScale = 3.0;
  let canvasPages = [];
  let isDragging=false, dragStartX=0, dragStartY=0, scrollStartX=0, scrollStartY=0;

  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

  /* TOAST */
  function showToast(message, type='error', duration=5000){
    toast.innerHTML = '';
    const icons = { success: '✅', error: '❌', info: 'ℹ️' };
    const colors = { success: 'text-green-400', error: 'text-red-400', info: 'text-blue-400' };

    const iconSpan = document.createElement('span');
    iconSpan.textContent = icons[type] || icons.info;
    iconSpan.className = colors[type] || colors.info;

    const textSpan = document.createElement('span');
    textSpan.textContent = message;

    toast.appendChild(iconSpan);
    toast.appendChild(textSpan);

    toast.classList.remove('opacity-0', 'translate-y-4');
    toast.classList.add('opacity-100');

    clearTimeout(toast._hideTimer);
    toast._hideTimer = setTimeout(()=>{
      toast.classList.add('opacity-0');
      toast.classList.remove('opacity-100');
    }, duration);
  }

  /* Render wszystkich stron PDF */
  async function renderAllPages(){
    pdfView.innerHTML = '';
    pdfThumbs.innerHTML = '';
    canvasPages = [];

    for(let i=1; i<=pdfDoc.numPages; i++){
      const page = await pdfDoc.getPage(i);
      const viewport = page.getViewport({ scale });

      // Główny canvas
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = viewport.width;
      canvas.height = viewport.height;
      canvas.classList.add('shadow-md','border','border-gray-400','dark:border-gray-600','rounded');
      await page.render({ canvasContext: ctx, viewport }).promise;
      pdfView.appendChild(canvas);
      canvasPages.push({ canvas, page });

      // Miniaturka
      const thumb = document.createElement('canvas');
      thumb.width = 50;
      thumb.height = 50 * (viewport.height / viewport.width);
      const tctx = thumb.getContext('2d');
      const thumbViewport = page.getViewport({ scale: 50 / viewport.width });
      await page.render({ canvasContext: tctx, viewport: thumbViewport }).promise;
      thumb.classList.add('cursor-pointer','border','border-gray-300','dark:border-gray-600','rounded');
      thumb.onclick = () => { canvas.scrollIntoView({ behavior: 'smooth', block: 'start' }); };
      pdfThumbs.appendChild(thumb);
    }

    updateDragCursor();
    zoomLevelDisplay.textContent = Math.round(scale*100) + '%';
  }

  /* Load PDF z URL lub blob URL */
  function loadPDF(fileUrl){
    pdfjsLib.getDocument(fileUrl).promise.then(async pdf=>{
      pdfDoc = pdf;
      await renderAllPages();
      showToast('PDF wczytany poprawnie!', 'success', 5000);
    }).catch(err=>{
      console.error(err);
      showToast('Błąd ładowania PDF!', 'error', 5000);
    });
  }

  /* Obsługa przycisku Open File */
  btnOpenFile.onclick = ()=> fileInput.click();
  fileInput.onchange = e => handleFile(e.target.files[0]);

  function handleFile(file){
    if(!file) return;
    if(file.type !== 'application/pdf'){
      showToast('Nieobsługiwany format. Wczytaj PDF.', 'error', 5000);
      return;
    }
    if(file.size > MAX_FILE_SIZE){
      showToast('Plik za duży. Maksymalnie 10 MB.', 'error', 5000);
      return;
    }
    if(errorMsg) errorMsg.classList.add('hidden');
    loadPDF(URL.createObjectURL(file));
  }

  /* Zoom */
  async function renderZoom(){
    if(!pdfDoc) return;
    for(const {canvas, page} of canvasPages){
      const viewport = page.getViewport({ scale });
      canvas.width = viewport.width;
      canvas.height = viewport.height;
      await page.render({ canvasContext: canvas.getContext('2d'), viewport }).promise;
    }
    zoomLevelDisplay.textContent = Math.round(scale*100) + '%';
    updateDragCursor();
  }

  btnZoomIn.onclick = ()=> { if(scale < maxScale){ scale = +(scale + 0.2).toFixed(2); renderZoom(); } };
  btnZoomOut.onclick = ()=> { if(scale > minScale){ scale = +(scale - 0.2).toFixed(2); renderZoom(); } };
  btnResetZoom.onclick = ()=> { scale = 1.2; renderZoom(); };

  /* Fit */
  btnFitWidth.onclick = ()=>{
    if(!pdfDoc || !canvasPages.length) return;
    pdfDoc.getPage(1).then(p=>{
      const viewport = p.getViewport({ scale:1 });
      scale = (pdfView.clientWidth - 20) / viewport.width;
      renderZoom();
    });
  };
  btnFitHeight.onclick = ()=>{
    if(!pdfDoc || !canvasPages.length) return;
    pdfDoc.getPage(1).then(p=>{
      const viewport = p.getViewport({ scale:1 });
      scale = Math.min((pdfView.clientHeight - 20)/viewport.height, (pdfView.clientWidth - 20)/viewport.width);
      renderZoom();
    });
  };

  /* Drag-to-pan */
  function updateDragCursor(){
    if(!canvasPages.length){ pdfView.style.cursor='default'; return; }
    const firstCanvas = canvasPages[0].canvas;
    const exceedsWidth = firstCanvas.width > pdfView.clientWidth;
    const exceedsHeight = firstCanvas.height > pdfView.clientHeight;
    pdfView.style.cursor = (exceedsWidth||exceedsHeight)?'grab':'default';
  }
  pdfView.addEventListener('mousedown', e=>{
    const firstCanvas = canvasPages[0]?.canvas;
    if(!firstCanvas) return;
    if(!(firstCanvas.width>pdfView.clientWidth || firstCanvas.height>pdfView.clientHeight)) return;
    isDragging=true;
    pdfView.style.cursor='grabbing';
    dragStartX=e.clientX; dragStartY=e.clientY;
    scrollStartX=pdfView.scrollLeft; scrollStartY=pdfView.scrollTop;
  });
  window.addEventListener('mousemove', e=>{
    if(!isDragging) return;
    pdfView.scrollLeft = scrollStartX - (e.clientX - dragStartX);
    pdfView.scrollTop = scrollStartY - (e.clientY - dragStartY);
  });
  window.addEventListener('mouseup', ()=>{ isDragging=false; updateDragCursor(); });

  pdfView.addEventListener('dragover', e=>{ e.preventDefault(); e.dataTransfer.dropEffect='copy'; });
  pdfView.addEventListener('drop', e=>{ e.preventDefault(); handleFile(e.dataTransfer.files[0]); });

  /* PageUp/Down & Ctrl +/- */
  window.addEventListener('keydown', e=>{
    if(e.key==='PageDown') pdfView.scrollBy({ top: window.innerHeight, behavior:'smooth' });
    if(e.key==='PageUp') pdfView.scrollBy({ top:-window.innerHeight, behavior:'smooth' });

    if(!e.ctrlKey) return;
    if(e.key==='+'||e.key==='='){ e.preventDefault(); if(scale<maxScale){ scale=+(scale+0.2).toFixed(2); renderZoom(); } }
    if(e.key==='-'){ e.preventDefault(); if(scale>minScale){ scale=+(scale-0.2).toFixed(2); renderZoom(); } }
  });

  /* Wczytanie domyślnego PDF */
  window.addEventListener('DOMContentLoaded', ()=>{
    loadPDF(defaultPDF); // najprostszy i pewny sposób – wszystkie strony wczytane
  });
</script>



<script src="./app.js"></script>
</body>
</html>